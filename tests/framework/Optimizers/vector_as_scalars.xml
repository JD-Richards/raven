<?xml version="1.0" ?>
<Simulation verbosity="debug">
  <TestInfo>
    <name>framework/Optimizers.VectorAsScalars</name>
    <author>talbpaul</author>
    <created>2018-04-24</created>
    <classesTested>Optimizer</classesTested>
    <description>
      This test is used to compare against "Optimizers.Vector" to assure both are operating in the same way.

      Note that the order of variables is important, hence why variables are named yA through yK,
      since y0 through y10 get sorted alphanumerically with y10 between y1 and y2.
    </description>
    <analytic>
      This test uses a model based on the "time_parabola", $f(x,y(t)) = x^2 + (t-y)^2 e^(-t)$.  This parabola has a minimum
      at x=0 and at y=t for every value of t, with the earliest values of y (yA, yB) being much more impactful than the later
      values of y (yJ,yK).
    </analytic>
  </TestInfo>

  <RunInfo>
    <WorkingDir>Vector</WorkingDir>
    <Sequence>optimize,print</Sequence>
    <batchSize>1</batchSize>
  </RunInfo>

  <VariableGroups>
    <Group name="y_vars">yA,yB,yC,yD,yE,yF,yG,yH,yI,yJ,yK</Group>
  </VariableGroups>

  <Steps>
    <MultiRun name="optimize">
      <Input class="DataObjects" type="PointSet">dummyIN</Input>
      <Model class="Models" type="ExternalModel">parabola</Model>
      <Optimizer class="Optimizers" type="SPSA">opter</Optimizer>
      <SolutionExport class="DataObjects" type="PointSet">opt_export</SolutionExport>
      <Output class="DataObjects" type="DataSet">optOut</Output>
    </MultiRun>
    <IOStep name="print" pauseAtEnd="True">
      <Input class="DataObjects" type="PointSet">opt_export</Input>
      <Input class="DataObjects" type="DataSet">optOut</Input>
      <Output class="OutStreams" type="Print">opt_export_vec</Output>
      <Output class="OutStreams" type="Print">opt_out_vec</Output>
    </IOStep>
  </Steps>

  <Optimizers>
    <SPSA name="opter">
      <initialization>
        <limit>2000</limit>
        <initialSeed>42</initialSeed>
        <thresholdTrajRemoval>1e-5</thresholdTrajRemoval>
        <writeSteps>every</writeSteps>
      </initialization>
      <TargetEvaluation class="DataObjects" type="PointSet">optOut</TargetEvaluation>
      <convergence>
        <gradientThreshold>1e-3</gradientThreshold>
        <relativeThreshold>1e-5</relativeThreshold>
        <gainGrowthFactor>3</gainGrowthFactor>
        <gainShrinkFactor>1.2</gainShrinkFactor>
      </convergence>
      <variable name="x">
        <upperBound>6</upperBound>
        <lowerBound>-6</lowerBound>
        <initial>-2</initial>
      </variable>
      <variable name="yA">
        <upperBound>6</upperBound>
        <lowerBound>-6</lowerBound>
        <initial>0</initial>
      </variable>
      <variable name="yB">
        <upperBound>6</upperBound>
        <lowerBound>-6</lowerBound>
        <initial>0</initial>
      </variable>
      <variable name="yC">
        <upperBound>6</upperBound>
        <lowerBound>-6</lowerBound>
        <initial>0</initial>
      </variable>
      <variable name="yD">
        <upperBound>6</upperBound>
        <lowerBound>-6</lowerBound>
        <initial>0</initial>
      </variable>
      <variable name="yE">
        <upperBound>6</upperBound>
        <lowerBound>-6</lowerBound>
        <initial>0</initial>
      </variable>
      <variable name="yF">
        <upperBound>6</upperBound>
        <lowerBound>-6</lowerBound>
        <initial>0</initial>
      </variable>
      <variable name="yG">
        <upperBound>6</upperBound>
        <lowerBound>-6</lowerBound>
        <initial>0</initial>
      </variable>
      <variable name="yH">
        <upperBound>6</upperBound>
        <lowerBound>-6</lowerBound>
        <initial>0</initial>
      </variable>
      <variable name="yI">
        <upperBound>6</upperBound>
        <lowerBound>-6</lowerBound>
        <initial>0</initial>
      </variable>
      <variable name="yJ">
        <upperBound>6</upperBound>
        <lowerBound>-6</lowerBound>
        <initial>0</initial>
      </variable>
      <variable name="yK">
        <upperBound>6</upperBound>
        <lowerBound>-6</lowerBound>
        <initial>0</initial>
      </variable>
      <parameter>
        <a>3</a>
        <A>50</A>
      </parameter>
      <objectVar>ans</objectVar>
    </SPSA>
  </Optimizers>

  <Models>
    <ExternalModel ModuleToLoad="time_parabola_vec" name="parabola" subType="">
      <variables>x,y_vars,ans</variables>
    </ExternalModel>
  </Models>

  <DataObjects>
    <PointSet name="dummyIN">
      <Input>x,y_vars</Input>
      <Output>OutputPlaceHolder</Output>
    </PointSet>
    <PointSet name="optOut">
      <Input>x,y_vars</Input>
      <Output>ans</Output>
    </PointSet>
    <PointSet name="opt_export">
      <Input>trajID</Input>
      <Output>x,y_vars,ans,varsUpdate</Output>
    </PointSet>
  </DataObjects>

  <OutStreams>
    <Print name="opt_export_vec">
      <type>csv</type>
      <source>opt_export</source>
      <clusterLabel>trajID</clusterLabel>
    </Print>
    <Print name="opt_out_vec">
      <type>csv</type>
      <source>optOut</source>
    </Print>
  </OutStreams>

</Simulation>
